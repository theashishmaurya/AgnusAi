# v2 Roadmap — Deeper Code Intelligence

The following features extend AgnusAI beyond diff-level reviews into full codebase understanding.

## Priority Overview

| Priority | Feature | Impact | Effort | Status |
|----------|---------|--------|--------|--------|
| **P2** | TypeScript Type Checking | Medium | Medium | Not Started |
| **P2** | Codebase Embeddings | High | High | Not Started |
| **P3** | Multi-language LSP | Medium | High | Not Started |
| **P3** | Impact Analysis | High | High | Not Started |

---

## P2: TypeScript Type-Aware Reviews

Use the TypeScript Compiler API (`ts.createProgram`) to extract type information, diagnostics, and function signatures, then inject this context into the review prompt for richer analysis.

```
ts.createProgram() → TypeChecker → getTypeAtLocation()
     │
     ▼
Extract types, diagnostics, function signatures
     │
     ▼
Inject into review prompt → Type-aware LLM review
```

**What this enables:**
- Catch type errors the LLM can't see from diffs alone
- Understand overloaded function signatures
- Flag breaking changes to exported types

---

## P2: Codebase Embeddings (Context Awareness)

Chunk the codebase by function/class, generate embeddings via Vercel AI SDK `embedMany()`, and store them in a vector database (Qdrant). During review, retrieve semantically similar code patterns to enrich the review context.

```
Codebase → Chunker (function/class) → embedMany() → Qdrant
     │
     ▼
During review → Query similar patterns → Inject into context
```

**What this enables:**
- "This pattern is used differently in 3 other places"
- Cross-file consistency checks
- Detecting duplication across the codebase

---

## P3: Multi-language LSP + Impact Analysis

### LSP Servers

| Language | LSP Server |
|----------|------------|
| TypeScript | `ts.createProgram()` |
| Python | Pyright / Pylance |
| Go | gopls |
| Rust | rust-analyzer |
| Java | jdtls |

### Impact Analysis

- Find all dependents of changed functions/classes
- Detect breaking API changes
- Suggest related files that may need updates
- Generate call graphs for affected code paths

---

## v2 Architecture Target

```
┌─────────────────────────────────────────────────────────────────────┐
│                         GitHub Webhook                              │
│                   (PR events, comment replies)                      │
└─────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                        PR Event Handler                             │
│              • Incremental Diff Analyzer                            │
│              • Comment Manager (post/reply/resolve)                 │
└─────────────────────────────────────────────────────────────────────┘
                               │
          ┌────────────────────┼────────────────────┐
          ▼                    ▼                    ▼
┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐
│   LSP Manager    │  │  Context Builder  │  │    Vector DB     │
│  (P2/P3)         │  │                   │  │    (Qdrant)      │
│                  │  │ • Diff context    │  │                  │
│ • TypeScript     │  │ • Type info       │  │ • Embeddings     │
│ • Python (P3)    │  │ • Similar code    │  │ • Metadata       │
│ • Go (P3)        │  │ • Thread history  │  │ • Similarity     │
│ • Rust (P3)      │  │                   │  │   queries        │
└──────────────────┘  └──────────────────┘  └──────────────────┘
          │                    │                    │
          └────────────────────┼────────────────────┘
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                        LLM Backend (Vercel AI SDK)                  │
│              Ollama • Claude • OpenAI • Azure • Custom              │
└─────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                        Comment Manager                              │
│              • Post inline comments                                 │
│              • Reply to threads                                     │
│              • Resolve stale comments                               │
│              • Update checkpoint                                    │
└─────────────────────────────────────────────────────────────────────┘
```
